# 腾讯会议账号类型

需要购买商业版账号，方可使用远图所需的 API 功能。

# 腾讯会议的初始设置

在腾讯企业管理员界面的 “企业管理 > 账户管理 > 账户设置 > [组织名称] > 录制设置" 页面中：

1. 打开 “云录制” 以及在其下方的所有功能选项
1. 打开 "自动录制"
1. 打开 "当有参会成员入会时立即开启云录制"
1. 关闭 "主持人能够暂停/停止云录制"
1. 打开 "通过链接分享云录制"，并选择 "同企业可查看"

在远图后台：

1. 设置 `.env` 中的 `TM_* ` 参数。其中，`TM_USER_IDS` 是以逗号分隔的腾讯会议主持人ID列表
2. 调用 `/api/v1/cron.recycleMeetings` 创建相应的腾讯会议。详见 `.github/workflows/weekly.yml`

# 腾讯会议的定期刷新

我们要求用户通过平台网站的“加入”功能进入腾讯会议。为了避免用户保存并重复使用原始的腾讯会议链接，系统会定期自动创建新的会议并更新 `MeetingSlots` 数据库表。详见 `recycleMeeitngs` 函数。

如果需要手工创建会议，执行以下步骤：

1. 确认 `MeetingSlots` 表中的 `groupId` 列为 null
1. 用 `tmUserId` 列指定的用户账号登录腾讯会议网站：
    1. 删除现有的会议系列
    1. 创建新的周期性会议
    1. 将会议标题设置为 "请勿分享会议链接，请通过 yuantuapp.com 进入会议"
    1. “重复频率” 选择 “每月”
    1. “结束重复” 选择距今最远的日期
    1. 关闭“开启文字水印”
    1. 其他选项保留默认值
1. 更新 `MeetingSlots` 表中的 `meetingId` 和 `meetingLink` 列

# 增加主持人账号

按以下步骤添加新的主持人账号，为系统扩容：

1. 在腾讯会议网站购买主持人账号，并赋权给一个新创建的用户
1. 把此用户ID添加到 `.env` 的 `TM_USER_IDS` 列表
1. 调用服务器 API `/api/v1/cron.recycleMeetings`
